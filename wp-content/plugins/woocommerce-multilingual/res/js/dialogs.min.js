var WCML_Dialog=WCML_Dialog||{};jQuery(function(a){WCML_Dialog.dialog=function(b,c){var d=this;"undefined"==typeof b&&(b="generic"),d.overflow_y=a("body").css("overflow-y"),a("body").css("overflow-y","hidden");var e=a("#wcml-dialog-"+b),f=a("#"+b).attr("title");if("undefined"==typeof f&&(f="undefined"!=c.title?c.title:""),!e.length){a(document.body).append(a('<div class="wcml-dialog-container" title="'+f+'" id="wcml-dialog-'+b+'" />')),e=a("#wcml-dialog-"+b);var g=a(window).height(),h={title:"",autoOpen:!1,show:!0,dialogClass:"wcml-ui-dialog otgs-ui-dialog",position:{my:"center",at:"center",of:window},modal:!0,width:"90%",height:.7*g,resizable:!1,draggable:!1,beforeOpen:function(a){},beforeClose:function(a){},close:function(b){a("body").css("overflow-y",d.overflow_y)},create:function(a){},focus:function(a){},open:function(a){},refresh:function(a){}};"undefined"!=typeof c.height&&(h.height=Math.min(.7*g,c.height)),"undefined"!=typeof c.width&&(h.width=c.width),WCML_Dialog.using_wpdialog?e.wpdialog(h):e.dialog(h)}if(WCML_Dialog.using_wpdialog?e.wpdialog("open"):e.dialog("open"),c.action){var i=a('<div class="spinner"></div>');i.css({display:"inline-block",visibility:"visible",float:"none"}),e.html(i),a.ajax({url:ajaxurl,type:"post",dataType:"json",data:c,success:function(a){e.html(a.html)}})}return c.content&&a("#"+c.content).length&&e.html(a("#"+c.content).html()),"undefined"!=typeof WCML_Tooltip&&WCML_Tooltip.init(),!1},WCML_Dialog._register_open_handler=function(){a(document).on("click",".js-wcml-dialog-trigger",function(b){b.preventDefault();var c=!1;a(this).data("dialog")?c=a(this).data("dialog"):a(this).data("action")&&(c=a(this).data("action")),c&&(a(this).data("action")&&a(this).data("action",a(this).data("action").replace(/-/g,"_")),WCML_Dialog.dialog(c,a(this).data()))})},WCML_Dialog._register_close_handler=function(){a(document).on("click",".wcml-dialog-close-button",function(b){b.preventDefault(),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),a(".wcml-dialog").find(".mce_editor textarea").each(function(){var b=a(this).attr("id"),c=a(this);if(b in tinyMCE.editors){var d=tinyMCE.get(b);d.isHidden()||c.val(d.getContent())}});var c=a(this).closest(".wcml-dialog-container"),d=a(this);d.attr("disabled","disabled");var e=a(this).data();if(e.action){var f=a('<div class="spinner"></div>');f.css({visibility:"visible",float:"right"}).prependTo(a(".wcml-dialog-footer .alignright")),a.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:e.action,fields:d.closest(".wcml-dialog-container").find("form").serialize(),icl_nonce:e.nonce},async:!1,success:function(a){e.stay&&(f.remove(),d.removeAttr("disabled"))}})}e.stay||(d.trigger("before_close_dialog"),WCML_Dialog.using_wpdialog?c.wpdialog("close"):c.dialog("close"))})},WCML_Dialog.init=function(){a(document).ready(function(){"undefined"!=typeof a.wp?WCML_Dialog.using_wpdialog="undefined"!=typeof a.wp.wpdialog:WCML_Dialog.using_wpdialog=!1,WCML_Dialog._register_open_handler(),WCML_Dialog._register_close_handler()})},WCML_Dialog.init()});